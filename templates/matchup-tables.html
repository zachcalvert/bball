{% load staticfiles stat_filters %}

<table cellpadding="0" cellspacing="1" border="1" id="totals_table_0" bordercolor="FFFFFF">
	<tbody>
		<tr id="table_row_head_0">
			<td style="text-align:left"colspan="1">TEAM</td>
			<td class="matchupLeadingSpacer"></td>
			<th colspan="9">STATISTICS</th>
			<td class="matchupLeadingSpacer"></td>
			<th style="text-align:right">TOTAL</th>
		</tr>
		<tr id="table_subrow_head_0">
			<td style="text-align:left">NAME</td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">FG%</td>
			<td style="text-align:right">FT%</td>
			<td style="text-align:right">3PM</td>
			<td style="text-align:right">REB</td>
			<td style="text-align:right">AST</td>
			<td style="text-align:right">STL</td>
			<td style="text-align:right">BLK</td>
			<td style="text-align:right">TO</td>
			<td style="text-align:right">PTS</td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">SCORE</td>
		</tr>
		<tr id="matchup_table_row_0">
			<td style="text-align:left"><a href="{% url 'team_profile' matchup.home_team.id days_since_start %}">{{ matchup.home_team }}</a></td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">{{ matchup.home_totals.fgpct|format_pct }}</td>
			<td style="text-align:right">{{ matchup.home_totals.ftpct|format_pct }}</td>
			<td style="text-align:right">{{ matchup.home_totals.threes }}</td>
			<td style="text-align:right">{{ matchup.home_totals.rebounds }}</td>
			<td style="text-align:right">{{ matchup.home_totals.assists }}</td>
			<td style="text-align:right">{{ matchup.home_totals.steals }}</td>
			<td style="text-align:right">{{ matchup.home_totals.blocks }}</td>
			<td style="text-align:right">{{ matchup.home_totals.turnovers }}</td>
			<td style="text-align:right">{{ matchup.home_totals.points }}</td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">{{ matchup.home_totals.result }}</td>
		</tr>
		<tr id="matchup_table_row_0">
			<td style="text-align:left"><a href="{% url 'team_profile' matchup.away_team.id days_since_start %}">{{ matchup.away_team }}</a></td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">{{ matchup.away_totals.fgpct|format_pct }}</td>
			<td style="text-align:right">{{ matchup.away_totals.ftpct|format_pct }}</td>
			<td style="text-align:right">{{ matchup.away_totals.threes }}</td>
			<td style="text-align:right">{{ matchup.away_totals.rebounds }}</td>
			<td style="text-align:right">{{ matchup.away_totals.assists }}</td>
			<td style="text-align:right">{{ matchup.away_totals.steals }}</td>
			<td style="text-align:right">{{ matchup.away_totals.blocks }}</td>
			<td style="text-align:right">{{ matchup.away_totals.turnovers }}</td>
			<td style="text-align:right">{{ matchup.away_totals.points }}</td>
			<td class="matchupLeadingSpacer"></td>
			<td style="text-align:right">{{ matchup.away_totals.result }}</td>
		</tr>
	</tbody>

</table>

<table class="home_table" cellpadding="0" cellspacing="1" border="1" id="teamtable_0" bordercolor="FFFFFF">
	<tbody>
		<tr id="table_row_head_0">
			<th colspan="100">{{ matchup.home_team }} BOX SCORE</th>
		</tr>
		<tr id="table_subrow_head_0">
			<th colspan="1" class="home_section_header_first">PLAYERS</td>
			<th colspan="1">MATCHUP {{ matchup.week }}</td>
			<td class="matchupLeadingSpacer"></td>
			<th colspan="13">TOTAL STATISTICS</td>
		</tr>
		<tr id="table_subrow_head_1">
			<td>PLAYER, TEAM POS</td>
			<td title="Games over this period">GAMES: OPPONENTS</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="home_table_stat"><span title="Games Played">GP</span></td>
			<td class="home_table_stat"><span title="Minutes">MIN</span></td>
			<td class="home_table_stat"><span title="Field Goals Made">FGM</span>/<span title="Field Goals Attempted">FGA</span></td>
			<td class="home_table_stat"><span title="Field Goal Percentage">FG%</span></td>
			<td class="home_table_stat"><span title="Free Throws Made">FTM</span>/<span title="Free Throws Attempted">FTA</span></td>
			<td class="home_table_stat"><span title="Free Throw Percentage">FT%</span></td>
			<td class="home_table_stat"><span title="Three Pointers Made">3PM</span></td>
			<td class="home_table_stat"><span title="Rebounds">REB</span></td>
			<td class="home_table_stat"><span title="Assists">AST</span></td>
			<td class="home_table_stat"><span title="Steals">STL</span></td>
			<td class="home_table_stat"><span title="Blocks">BLK</span></td>
			<td class="home_table_stat"><span title="Turnovers">TO</span></td>
			<td class="home_table_stat"><span title="Points">PTS</span></td>
		</tr>

		{% for player in home_stats.iteritems %}
		<tr class="home_stats_player_row">
			<td><a href="{% url 'player_profile' player.0 days_since_start %}">{{ player.1.name }}</a>, {{ player.1.nba_team}} 
				{{ player.1.position }}</td>
			<td>{{ player.1.matchup_games | format_matchup_games }}</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="player_table_stat">{{ player.1.games_played }}</td>
			<td class="player_table_stat">{{ player.1.minutes }}</td>
			<td class="player_table_stat"><span>{{ player.1.fgm }}</span>/<span>{{ player.1.fga }}</span></td>
			<td class="player_table_stat">{{ player.1.fgpct|format_pct }}</td>
			<td class="player_table_stat"><span>{{ player.1.ftm }}</span>/<span>{{ player.1.fta }}</span></td>
			<td class="player_table_stat">{{ player.1.ftpct|format_pct }}</td>
			<td class="player_table_stat">{{ player.1.threes }}</td>
			<td class="player_table_stat">{{ player.1.rebounds }}</td>
			<td class="player_table_stat">{{ player.1.assists }}</td>
			<td class="player_table_stat">{{ player.1.steals }}</td>
			<td class="player_table_stat">{{ player.1.blocks }}</td>
			<td class="player_table_stat">{{ player.1.turnovers }}</td>
			<td class="player_table_stat">{{ player.1.points }}</td>
  		</tr>
		{% endfor %}
		<tr id="team_stats_total_row">
			<td></td>
			<td>TOTALS</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="player_table_stat">{{ matchup.home_totals.games_played }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.minutes }}</td>
			<td class="player_table_stat"><span>{{ matchup.home_totals.fgm }}</span>/<span>{{ matchup.home_totals.fga }}</span></td>
			<td class="player_table_stat">{{ matchup.home_totals.fgpct|format_pct }}</td>
			<td class="player_table_stat"><span>{{ matchup.home_totals.ftm }}</span>/<span>{{ matchup.home_totals.fta }}</span></td>
			<td class="player_table_stat">{{ matchup.home_totals.ftpct|format_pct}}</td>
			<td class="player_table_stat">{{ matchup.home_totals.threes }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.rebounds }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.assists }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.steals }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.blocks }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.turnovers }}</td>
			<td class="player_table_stat">{{ matchup.home_totals.points }}</td>
  		</tr>
	</tbody>
</table>

<table class="away_table" cellpadding="0" cellspacing="1" border="1" id="teamtable_0" bordercolor="FFFFFF">
	<tbody>
		<tr id="table_row_head_0">
			<th colspan="100">{{ matchup.away_team }} BOX SCORE</th>
		</tr>
		<tr id="table_subrow_head_0">
			<th colspan="1" class="home_section_header_first">PLAYERS</td>
			<th colspan="1">MATCHUP {{ matchup.week }}</td>
			<td class="matchupLeadingSpacer"></td>
			<th colspan="13">TOTAL STATISTICS</td>
		</tr>
		<tr id="table_subrow_head_1">
			<td>PLAYER, TEAM POS</td>
			<td title="Games over this period">GAMES: OPPONENTS</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="home_table_stat"><span title="Games Played">GP</span></td>
			<td class="home_table_stat"><span title="Minutes">MIN</span></td>
			<td class="home_table_stat"><span title="Field Goals Made">FGM</span>/<span title="Field Goals Attempted">FGA</span></td>
			<td class="home_table_stat"><span title="Field Goal Percentage">FG%</span></td>
			<td class="home_table_stat"><span title="Free Throws Made">FTM</span>/<span title="Free Throws Attempted">FTA</span></td>
			<td class="home_table_stat"><span title="Free Throw Percentage">FT%</span></td>
			<td class="home_table_stat"><span title="Three Pointers Made">3PM</span></td>
			<td class="home_table_stat"><span title="Rebounds">REB</span></td>
			<td class="home_table_stat"><span title="Assists">AST</span></td>
			<td class="home_table_stat"><span title="Steals">STL</span></td>
			<td class="home_table_stat"><span title="Blocks">BLK</span></td>
			<td class="home_table_stat"><span title="Turnovers">TO</span></td>
			<td class="home_table_stat"><span title="Points">PTS</span></td>
		</tr>

		{% for player in away_stats.iteritems %}
		<tr class="home_stats_player_row">
			<td><a href="{% url 'player_profile' player.0 days_since_start %}">{{ player.1.name }}</a>, {{ player.1.nba_team}} 
				{{ player.1.position }}</td>
			<td>{{ player.1.matchup_games | format_matchup_games }}</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="player_table_stat">{{ player.1.games_played }}</td>
			<td class="player_table_stat">{{ player.1.minutes }}</td>
			<td class="player_table_stat"><span>{{ player.1.fgm }}</span>/<span>{{ player.1.fga }}</span></td>
			<td class="player_table_stat">{{ player.1.fgpct|format_pct }}</td>
			<td class="player_table_stat"><span>{{ player.1.ftm }}</span>/<span>{{ player.1.fta }}</span></td>
			<td class="player_table_stat">{{ player.1.ftpct|format_pct }}</td>
			<td class="player_table_stat">{{ player.1.threes }}</td>
			<td class="player_table_stat">{{ player.1.rebounds }}</td>
			<td class="player_table_stat">{{ player.1.assists }}</td>
			<td class="player_table_stat">{{ player.1.steals }}</td>
			<td class="player_table_stat">{{ player.1.blocks }}</td>
			<td class="player_table_stat">{{ player.1.turnovers }}</td>
			<td class="player_table_stat">{{ player.1.points }}</td>
  		</tr>
		{% endfor %}
		<tr id="team_stats_total_row">
			<td></td>
			<td>TOTALS</td>
			<td class="matchupLeadingSpacer"></td>
			<td class="player_table_stat">{{ matchup.away_totals.games_played }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.minutes }}</td>
			<td class="player_table_stat"><span>{{ matchup.away_totals.fgm }}</span>/<span>{{ matchup.away_totals.fga }}</span></td>
			<td class="player_table_stat">{{ matchup.away_totals.fgpct|format_pct }}</td>
			<td class="player_table_stat"><span>{{ matchup.away_totals.ftm }}</span>/<span>{{ matchup.away_totals.fta }}</span></td>
			<td class="player_table_stat">{{ matchup.away_totals.ftpct|format_pct}}</td>
			<td class="player_table_stat">{{ matchup.away_totals.threes }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.rebounds }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.assists }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.steals }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.blocks }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.turnovers }}</td>
			<td class="player_table_stat">{{ matchup.away_totals.points }}</td>
  		</tr>
	</tbody>
</table>
<script>
	String.prototype.format = function() {
    var s = this,
        i = arguments.length;

    while (i--) {
        s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
    }
    return s;
	};


	var table = document.getElementById("totals_table_0");
	for (var i = 0, row; row = table.rows[i]; i++) {
		var away_wins = 0;
     	var home_wins = 0;
     	var ties = 0;
	   //iterate through rows
	   //rows would be accessed using the "row" variable assigned in the for loop
		if (i==3) {   
		   for (var j = 0, col; col = row.cells[j]; j++) {
			    var row_above = table.rows[i-1]
			    var cell_above = row_above.cells[j]
			    if (j==0 || j==1 || j==11 || j==12){}
			    // fuckin turnovers, reverse the operators
			    else if (j==9) {
			    	if (col.textContent < cell_above.textContent) {
				    	col.style.fontWeight = 'bold';
				    	home_wins++;

				    } else if (col.textContent > cell_above.textContent){
				    	cell_above.style.fontWeight = 'bold';
				    	away_wins += 1;
				    } else{
				    	ties = ties + 1;
				    }
			    } else {
				    if (col.textContent > cell_above.textContent) {
				    	col.style.fontWeight = 'bold';
				    	home_wins++;

				    } else if (col.textContent < cell_above.textContent){
				    	cell_above.style.fontWeight = 'bold';
				    	away_wins += 1;
				    	console.log(away_wins)
				    } else{
				    	ties = ties + 1;
				    }
				}
			}
		var home_result = row_above.cells[12];
		var away_result = row.cells[12];
		if (ties == 0) {
			home_result.innerHTML="{0}-{1}".format(away_wins, home_wins);
		   	away_result.innerHTML="{0}-{1}".format(home_wins, away_wins);
		} else {
			home_result.innerHTML="{0}-{1}-{2}".format(away_wins, home_wins, ties);
		   	away_result.innerHTML="{0}-{1}-{2}".format(home_wins, away_wins, ties);
		}
		if (away_result.innerHTML > home_result.innerHTML) {
	   		away_result.style.fontWeight = 'bold';
	   	} else {
	   		home_result.style.fontWeight = 'bold';
	   	}
	   }
	}
</script>
